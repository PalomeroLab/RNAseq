#!/bin/bash

set -euo pipefail

BASE=~/data
JOBS=$(nproc)

find "$BASE/scRNA-seq" "$BASE/tapestri" -mindepth 1 -maxdepth 1 -type d | parallel -j "$JOBS" '
  cd "{}"
  for fq in *.fastq.gz; do
    [[ -f "$fq" ]] || continue
    md5="$fq.md5"

    if [[ -f "$md5" ]]; then
      if md5sum -c "$md5" --quiet; then
        echo "OK: $fq"
      else
        echo "FAIL: $fq"
      fi
    else
      md5sum "$fq" > "$md5"
      echo "CREATED: $md5"
    fi
  done
'

